<?xml version="1.0"?>
<openerp>
    <data>
        <!-- INHERIT stock.picking-->
        <record model="ir.ui.view" id="view_stock_picking_fast_tree">
            <field name="name">stock.picking.tree</field>
            <field name="model">stock.picking</field>
            <field name="priority" eval="40" />
            <field name="arch" type="xml">
                <tree string="String" colors="green:pick_state=='ready';blue:pick_state=='todo'">
                    <field name="partner_id" />
                    <field name="name"/>
                    <field name="date"/>      
                    <field name="min_date" />              
                    <!--<field name="device_id"/>
                    <field name="workers"/>
                    <field name="total_work"/>
                    <field name="total_prepare"/>
                    <field name="total_stop"/>-->
                    <field name="intervention_id" />
                    <field name="pick_state"/>
                    <field name="state" invisible="1"/>
                    <button name="pickwk_ready" string="Ready" type="object" attrs="{'invisible': [('pick_state','!=','todo')]}" class="oe_highlight"/>
                    <button name="pickwk_delivered" string="Delivered" type="object" attrs="{'invisible': [('pick_state','!=','ready')]}" class="oe_highlight"/>
                    <button name="pickwk_restart" string="Restart" type="object" attrs="{'invisible': [('pick_state','!=','delivered')]}" class="oe_highlight"/>
                    <button name="add_to_intervention" string="Add" type="object" class="oe_highlight" invisible="not context.get('show_move')" attrs="{'invisible': [('intervention_id','!=',False)]}"/>
                    <button name="remove_to_intervention" string="Unlink" type="object" attrs="{'invisible': [('intervention_id','=',False)]}" />
                </tree>
            </field>
        </record>                
        <record model="ir.ui.view" id="view_stock_picking_fast_form">
            <field name="name">stock.picking.form</field>
            <field name="model">stock.picking</field>
            <field name="priority" eval="40" />
            <field name="arch" type="xml">
                <form string="Transfer">
                    <header>
                        <button name="pickwk_ready" string="Ready" type="object" attrs="{'invisible': [('pick_state','!=','todo')]}" class="oe_highlight"/>
                        <button name="pickwk_delivered" string="Delivered" type="object" attrs="{'invisible': [('pick_state','!=','ready')]}" class="oe_highlight"/>
                        <button name="pickwk_restart" string="Restart" type="object" attrs="{'invisible': [('pick_state','!=','delivered')]}" class="oe_highlight"/>
                        <!--<button name="action_confirm" states="draft" string="Mark as Todo" type="object" class="oe_highlight" groups="base.group_user"/>
                        <button name="action_assign" states="confirmed" string="Check Availability" type="object" class="oe_highlight" groups="base.group_user"/>
                        <button name="rereserve_pick" string="Recheck Availability" type="object" class="oe_highlight" groups="base.group_user" attrs="{'invisible': ['|', ('state', 'not in', ('waiting', 'partially_available')), ('pack_operation_exist','=',True)]}"/>
                        <button name="force_assign" states="confirmed,waiting,partially_available" string="Force Availability" type="object" groups="base.group_user"/>
                        <button name="do_enter_transfer_details" states="assigned,partially_available" string="Transfer" groups="stock.group_stock_user" type="object" class="oe_highlight"/>
                        <button name="do_print_picking" string="Print Picking List" groups="stock.group_stock_user" type="object" attrs="{'invisible': ['|', ('picking_type_code', '=', 'outgoing'), ('state', '!=', 'assigned')]}"/>
                        <button name="290" string="Reverse Transfer" states="done" type="action" groups="base.group_user"/>
                        <button name="action_cancel" states="assigned,confirmed,partially_available,draft,waiting" string="Cancel Transfer" groups="base.group_user" type="object"/>
                        <button name="do_unreserve" string="Unreserve" groups="base.group_user" type="object" attrs="{'invisible': [('quant_reserved_exist', '=', False)]}"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,confirmed,partially_available,assigned,done" statusbar_colors="{&quot;shipping_except&quot;:&quot;red&quot;,&quot;invoice_except&quot;:&quot;red&quot;,&quot;waiting_date&quot;:&quot;blue&quot;}"/>-->
                        
                        <field name="state" invisible="1"/>
                        <field name="pick_state" widget="statusbar" />
                    </header>
                    <sheet>
                        <!--<div class="oe_right oe_button_box">
                            <button name="do_partial_open_barcode" groups="stock.group_stock_user" type="object" class="oe_stock_scan_button" attrs="{'invisible': ['|',('pack_operation_exist', '=', True),('state','not in',('assigned', 'partially_available'))]}"><img src="/stock/static/src/img/scan.png" class="oe_stock_scan_image oe_stock_scan_image_btn"/></button>
                            <button name="open_barcode_interface" groups="stock.group_stock_user" type="object" class="oe_stock_scan_button" attrs="{'invisible': ['|',('pack_operation_exist', '=', False),('state','not in',('assigned', 'partially_available'))]}"><img src="/stock/static/src/img/scan.png" class="oe_stock_scan_image oe_stock_scan_image_btn"/></button>
                        </div>-->
                        <h1>
                            <field name="name" class="oe_inline" attrs="{'invisible': [('name','=','/')]}" readonly="1"/>
                        </h1>
                        <group>
                            <group>
                                <field name="partner_id"/>                            
                                <!--<field name="backorder_id" readonly="1" attrs="{'invisible': [('backorder_id','=',False)]}"/>-->
                                <field name="intervention_id" />
                            </group>
                            <group>
                                <field name="date"/>
                                <field name="min_date"/>
                                <!--<field name="origin" placeholder="e.g. PO0032" class="oe_inline"/>
                                <label for="owner_id" groups="stock.group_tracking_owner"/>
                                <div groups="stock.group_tracking_owner">
                                    <field name="owner_id"/>
                                    <button name="action_assign_owner" string="Assign Owner" type="object" attrs="{'invisible': ['|',('pack_operation_exist', '=', False),('state', 'not in', ('draft','assigned','confirmed'))]}" class="oe_link oe_edit_only"/>
                                </div>-->
                            </group>
                        </group>
                        <notebook>
                            <page string="Products">
                                <separator string="Stock Moves" attrs="{'invisible': [('pack_operation_exist', '=', False)]}"/>
                                <field name="move_lines" context="{'address_in_id': partner_id, 'default_picking_type_id': picking_type_id,'default_picking_id': active_id}">
                                    <tree string="Stock Moves" editable="bottom">
                                          <!--<button name="force_assign" states="confirmed" string="Force Availability" type="object" groups="base.group_user"/>
                                              <button name="action_confirm" states="draft" string="Confirm" type="object" groups="base.group_user"/>
                                              <button name="do_unreserve" states="assigned" string="Cancel Availability" type="object" groups="base.group_user"/>-->
                                        <field name="product_id" on_change="onchange_product_id(product_id,location_id,location_dest_id, parent.partner_id)"/>
                                        <field name="procure_method" attrs="{'readonly': [('state', '!=', 'draft')]}" groups="stock.group_adv_location"/>

                                        <!--<label for="product_uom_qty"/>
                                                <div>
                                                    <field name="product_uom_qty" on_change="onchange_quantity(product_id, product_uom_qty, product_uom, product_uos)" class="oe_inline"/>
                                                    <field name="product_uom" string="Unit Of Measure" groups="product.group_uom" class="oe_inline"/>
                                                    <button name="491" string="Scrap" type="action" icon="terp-gtk-jump-to-ltr" context="{'scrap': True}" states="draft,waiting,confirmed,assigned" groups="base.group_user"/>
                                                </div>
                                                <label for="product_uos_qty" groups="product.group_uos"/>
                                                <div groups="product.group_uos">
                                                </div>-->
                                        <field name="product_uom_qty" on_change="onchange_uos_quantity(product_id, product_uos_qty, product_uos, product_uom)" class="oe_inline" invisible="1"/>
                                        <field name="product_uom" on_change="onchange_quantity(product_id, product_uom_qty, product_uom, product_uos)" class="oe_inline" invisible="1"/>
                                        <field name="product_uos_qty" invisible="1"/>
                                        <field name="product_uos" invisible="1"/>

                                        <field name="name" invisible="1"/>
                                        <field name="date"/>
                                        <field name="date_expected" on_change="onchange_date(date,date_expected)"/>
                                        <field name="state" readonly="1"/>

                                        <!-- invisible="1"-->  
                                        <field name="product_packaging" groups="product.group_stock_packaging" domain="[('product_tmpl_id','=',product_tmpl_id)]" invisible="1"/>
                                        <field name="picking_type_id" invisible="1"/>
                                        <field name="group_id" invisible="1"/>
                                        <field name="create_date" invisible="1"/>
                                        <field name="product_tmpl_id" invisible="1"/>
                                        <field name="picking_id" invisible="1"/>
                                        <field name="location_id" domain="[('usage','&lt;&gt;','view')]" invisible="1"/>
                                        <field name="location_dest_id" domain="[('usage','&lt;&gt;','view')]" invisible="1"/>
                                        <field name="reserved_quant_ids" nolabel="1" invisible="1"/>                                        
                                        <field name="quant_ids" readonly="1" nolabel="1" invisible="1"/>                                        
                                    </tree>                                
                                </field>
                                <field name="pack_operation_exist" invisible="1"/>
                                <field name="note" placeholder="Add an internal note..." class="oe_inline"/>
                            </page>
                            
                            <!--INVISIBLE:-->
                            <page string="Operations" attrs="{'invisible': ['|', ('state','!=','done'), ('pack_operation_ids','=',[])]}" invisible="1">
                                <field name="pack_operation_ids" context="{'default_picking_id': active_id, 'default_location_id': location_id, 'default_location_dest_id': location_dest_id}">
                                    <tree editable="top">
                                        <field name="package_id" groups="stock.group_tracking_lot"/>
                                        <field name="product_id" on_change="product_id_change(product_id, product_uom_id, product_qty)"/>
                                        <field name="product_uom_id" groups="product.group_uom"/>
                                        <field name="lot_id" domain="[('product_id','=?', product_id)]" context="{'product_id': product_id}" groups="stock.group_production_lot"/>
                                        <field name="picking_id" invisible="1"/>
                                        <field name="owner_id" groups="stock.group_tracking_owner"/>
                                        <field name="product_qty" attrs="{'required': [('product_id', '!=', False)]}"/>
                                        <field name="location_id" domain="[('id', 'child_of', parent.location_id)]"/>
                                        <field name="location_dest_id" domain="[('id', 'child_of', parent.location_dest_id)]"/>
                                        <field name="result_package_id" groups="stock.group_tracking_lot" context="{'location_id': location_dest_id}"/>
                                    </tree>
                                </field>
                                <p class="oe_grey" groups="stock.group_tracking_lot">
                                If there is no product but a source package, this means the source package was moved entirely.  If there is a product and a source package, the product was taken from the source package.  
                                </p>
                            </page>
                            <page string="Additional Info" >
                                <group string="General Informations">
                                    <group>
                                        <field name="move_type"/>
                                        <field name="picking_type_id"/>
                                        <field name="picking_type_code" invisible="1"/>
                                        <field name="quant_reserved_exist" invisible="1"/>                                    
                                        <field name="location_id" invisible="1"/>
                                        <field name="location_dest_id" invisible="1"/>
                                    </group>
                                    <group invisible="1">
                                        <field name="company_id" groups="base.group_multi_company" widget="selection"/>
                                        <field name="date_done" groups="base.group_no_one"/>
                                        <field name="group_id"/>
                                        <field name="priority"/>
                                    </group>
                                </group>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>        
        
        <!--hr.analytic.timesheet-->
        <record model="ir.ui.view" id="view_hr_analytic_timesheet_delivery_form">
            <field name="name">hr.analytic.timesheet.delivery.page</field>
            <field name="model">hr.analytic.timesheet</field>
            <field name="inherit_id" ref="intervention_report.view_hr_analytic_timesheet_form"/>
            <field name="arch" type="xml">
                <page string="Accounting" position="before">
                       <page string="Delivery">                           
                           <group colspan="4" col="4">
                               <separator string="Current picking:" colspan="4"/>
                               <field name="picking_ids" nolabel="1" context="{'show_move': True, 'intervention_id': active_id, 'tree_view_ref': 'intervention_stock_move.view_stock_picking_fast_tree', 'form_view_ref': 'intervention_stock_move.view_stock_picking_fast_form'}"/>
                               
                               <separator string="Delivered picking:" colspan="4"/>
                               <field name="delivered_ids" nolabel="1" context="{'default_partner_id': intervent_partner_id, 'tree_view_ref': 'intervention_stock_move.view_stock_picking_fast_tree', 'form_view_ref': 'intervention_stock_move.view_stock_picking_fast_form'}"/>
                           </group> 
                       </page>                    
                </page>
            </field>
        </record>
        
        <record model="ir.actions.act_window" id="action_stock_picking">
            <field name="name">Picking</field>
            <field name="res_model">stock.picking</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="view_stock_picking_fast_tree"/>
            <field name="context">{'form_view_ref': 'intervention_stock_move.view_stock_picking_fast_form'}</field>
            <field name="domain">[]</field>
        </record>
        <record model="ir.actions.act_window" id="action_stock_movement">
            <field name="name">Stock move</field>
            <field name="res_model">stock.move</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <!--<field name="view_id" ref="view_stock_picking_fast_tree"/>
            <field name="context">{'form_view_ref': 'intervention_stock_move.view_stock_picking_fast_form'}</field>-->
            <field name="domain">[('picking_id', '!=', False)]</field>
        </record>
        
        <menuitem 
            parent="stock.menu_stock_root" 
            name="Delivery management"
            id="menu_stock_picking_root" 
            sequence="0"
            />
            <menuitem 
                parent="menu_stock_picking_root" 
                id="menu_stock_picking_picking" 
                action="action_stock_picking"
                sequence="10"
                />
            <menuitem 
                parent="menu_stock_picking_root" 
                id="menu_stock_picking_move" 
                action="action_stock_movement"
                sequence="20"
                />
            
        
    </data>
</openerp>

